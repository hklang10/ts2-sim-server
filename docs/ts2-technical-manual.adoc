= TS2 Technical Manual
Author Nicolas Piganeau
:prewrap!:
:toc:
:sectnums:

== Introduction

This document describes the internals of TS2.
It is aimed both at simulation writers and developers who want to interact with the simulation through its API.

== Architecture

TS2 is composed of 3 main components:

- The simulation server
- Clients
- The editor

=== The simulation server

This is the central piece of the software. It is shipped with the TS2 release.

It can be run:

- Locally for a standalone game
- Remotely on another PC or even on a cloud server for multi-player gaming

The TS2 sim server tasks are

- To centralize the game data, that is:
    * Scenery layout (The track items, and how they are connected to each other, their states, etc.)
    * Possible and set routes
    * Services and Trains

- To enforce interlocking on :
    * Route setting/unsetting
    * Change of points position
    * Update of signals aspects

- To compute train behaviour, speed and position

- Make the clock tick

The TS2 sim server communicates with clients through websocket.

.TS2 overall architecture
[plantuml, architecture_bdd, png]
....
usecase Client as "Client
(User Interface)"
:User: ..> (Client)
(Client) --> (Simulation Server) : Websocket \ncommunication
(Simulation Server) ---> (Client)
rectangle "Simulation file" as file
(Simulation Server) --> file : loads
:Sim Writer: ..> (Editor)
(Editor) --> file : creates
....

=== Clients

Clients are software that interact with the simulation server, typically to provide a user interface.

Many clients can be connected at the same time to the same simulation server.

The TS2 release ships two clients:

- The standard Python client, which is the main "all-in-one" client that is also able to spawn simulation servers and give access to the editor.
- A minimalist web client which is included with the simulation server and mainly used for API testing.
This client can be accessed at http://localhost:22222 when the sim server is running.

=== The Editor

The editor is part of the standard Python client and is used to create or modify simulations with a graphical user interface.

== Simulation model

A simulation in TS2 is modelled by the following objects:

- Options
- Track items
- Routes
- Train Types
- Services
- Trains
- Signal Library

=== Options

This is a list of options for the simulation.
They must be set at simulation writing time, but can be modified during the simulation.

The default values in the table below are set by the editor.
The simulation server itself has no default and expect all options to be set.

[cols="2,>3,8"]
|===
| Key ^| Default Value | Description

|`title`
|
|Title of the simulation

|`description`
|
|Detailed description of the simulation targeted at the user.

|`clientToken`
|client-secret
|Client token to connect to the simulation.
Unless you want to run a public instance of TS2 you can leave it to the default value.

|`version`
|0.7
|Defines the version of the file format. Do not change this value.

|`timeFactor`
|5
|The number of seconds elapsed in the simulation for each real seconds.
This value can be set between 1 and 10.

|`currentTime`
|06:00:00
|Current time inside the simulation.
When writing a simulation this will be the time when the simulation starts.
During the simulation run, this value is updated every 500ms.

|`warningSpeed`
|8.33
|Speed (in metres per second) a train driver will observe when given a "Proceed with caution" manual order from the dispatcher.
Default value is 30 km/h.

|`currentScore`
|0
|This value is the current penalty score of the simulation.
Obviously, it should be set to 0 when writing a simulation.

|`defaultMaxSpeed`
|44.44
|This speed (in metres per second) will be used by the simulation whenever a track item has a maximum speed of 0.
Default value is 160 km/h.

|`defaultMinimumStopTime`
|[(45, 75, 70), (75, 90, 30)]
|The time in seconds a train will normally stop at a station.
It can be a single value in seconds, or a <<DelayGenerators,delay generator>>.

|`defaultDelayAtEntry`
|[(-60, 0, 50), (0, 60, 50)]
|The delay in seconds a train will have by default when entering the area.
It can be a single value in seconds, or a <<DelayGenerators,delay generator>>.
If the value is negative, the train will be early.

This value can be overridden train by train.

|`trackCircuitBased`
|false
|This value defines the way the trains will be represented on the layout.
If it is true, each track item will be considered as a track circuit and will be either marked free or occupied.
If it is false, the occupied area will show the real position of the train.

This option should be set to true if you care about realism.

|`defaultSignalVisibility`
|100
|Distance in metres at which a driver can see a signal and will start taking it into account.

|`wrongPlatformPenalty`
|5
|Penalty points that will be added to the score each time a train stops at a wrong platform.

|`wrongDestinationPenalty`
|100
|Penalty points that will be added to the score each time a train is not routed out of the area at the correct exit point.

|`latePenalty`
|1
|Penalty points that will be added to the score per minute lost in the area.
Delay at entry is subtracted from the actual delay to define it.

|===


====
[[DelayGenerators]]
.**Delay generators**

Delay generators are expressions that will yield a random value according to a specified distribution.

They are composed of a list of triplets such as:
```python
[(45, 75, 70), (75, 90, 30)]
```
For each triplet, the values are in order:

- Minimum value
- Maximum value
- Percentage of occurrence

In the example above, the expression means:

- 70% of the time the value will be between 45 and 75
- 30% of the time the value will be between 75 and 90

Inside each triplet, the value is yielded with a uniform distribution.

====

=== Track Items

The layout of the tracks in the area is defined by 8 track item types:

- Line
- Signal
- Points
- Platform
- Place
- End
- InvisibleLink
- Text

Each type has "definition attributes" which can be set with the editor and "technical attributes" which are returned by the simulator through the API.

==== Common Attributes

All items share the following attributes.

===== Definition Attributes

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`id`
|ID
|Unique ID of the item. The editor sets it automatically and it cannot be modified by the user.


|`\\__type__`
|Type
|Type of the item. The type of an item cannot be changed.

|`name`
|Name (or Text)
|Name of the item as known in the real world (e.g. signal number).

|`x`
|Position (or Point1)
|Position of the item on the x-axis.

|`y`
|Position (or Point1)
a|Position of the item on the y-axis.

WARNING: y-axis increases from top to bottom.

|`maxSpeed`
|Maximum speed (m/s)
|Maximum speed allowed on this item in metres per second.

|`realLength`
|Real Length (m)
|Length of this item in real life (in metres).

|`conflictTiId`
|Conflict item ID
|Set to the ID of another item to prevent route setting on both items at the same time.
This feature is typically used to interlock track crossovers without points.

|===

===== Technical Attributes

[cols="2,8"]
|===
|Technical Name  |Description

|`previousTiId`
|ID of the track item connected to this item at its "origin" (see each item description).

This is computed automatically by the editor.

|`nextTiId`
|ID of the track item connected to this item at its "end" (see each item description)

This is computed automatically by the editor.

|`activeRoute`
|If a route is set on this item, this value is the ID of that route, otherwise it is null.

|`activeRoutePreviousItem`
|If a route is set on this item, this value is the ID of the item before this one in the direction of the route, otherwise it is null.

|`trainEndsFW`
a|Map of train extremities that are on the "end" side of this item (see each item description).

For example, `{"2": 79}` means that train with ID "2" has one of its extremity (head or tail) at 79 metres from this items "origin".

|`trainEndsBK`
a|Map of train extremities that are on the "origin" side of this item (see each item description).

For example, `{"2": 3}` means that train with ID "2" has one of its extremity (head or tail) at 3 metres from this items "origin".

|===

.trainEndsFW and trainEndsBK
====
Consider the following figure with 2 trains, going from left to right.
`Train 1` spans over 3 track items, while `Train 2` is over a single track item.

image::trainEnds.png[align=center]

In this situation, the `trainEndsBK` and `trainEndsFW` maps are as follow:

[cols="1,3"]
|===
|Item 1
| `trainsEndsBK = {"1": 420}`

`trainsEndsFW = {"1": 560}`

|Item 2
|`trainsEndsBK = {"1": 0}`

`trainsEndsFW = {"1": 120}`

|Item 3
|`trainsEndsBK = {"1": 511, "2": 23}`

`trainsEndsFW = {"1": 519, "2": 243}`
|===

NOTE: When the `trackCircuitBased` option is true, the `trainEndsBK` and `trainEndsFW` are always with a value of 0 or
 of the length of the item so that the latter is either completely covered by a train or not at all.
====

==== Line Items

A line item connects two points on the scenery.
One is defined as the "origin" and the other one as the "end" (arbitrarily).

image::lineitem.png[align=center]

Common attributes `x` and `y` define the position of the "origin", known as "Point 1" in the editor.

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`xf`
|Point 2
|Position of "end" on the x-axis.

|`yf`
|Point 2
a|Position of "end" on the y-axis.

WARNING: y-axis increases from top to bottom.

|`placeCode`
|Place code
|Code of the place item this line item belongs to.
The place being a station or a waypoint.

|`trackCode`
|Track code
|The code of this track as known in the place defined by `placeCode`.
Typically a line or platform number.

|===

==== Signal Items

Signal items are composed of two elements, the signal itself and the "berth" that will hold train descriptors on the layout.

image::signalitem.png[align=center]

===== Standard Attributes

Common attributes `x` and `y` define the position of entry in the signal which is the left point of the signal itself.
Note that when the signal is reversed, then it is the point of the signal on the right.

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`signalType`
|Signal Type
|The code of the type of signal as defined in the signal library (e.g. `UK_3_ASPECTS`)

|`reversed`
|Reverse
|If true, then the signal is for train coming from the right of the layout.

|`xn`
|Berth Origin
|Position of the berth on the x-axis.
The position is the bottom left corner of the berth.

|`yn`
|Berth Origin
a|Position of the berth on the y-axis.
The position is the bottom left corner of the berth.

WARNING: y-axis increases from top to bottom.

|===

===== Custom properties

Custom properties are defined by the available signal conditions.
Each property takes as value a map with signal aspect codes as keys and a list of related object IDs as values, such as:
```
{"UK_CLEAR": ["2", "34", "48"], "UK_CAUTION": ["2", "34"]}
```

Properties taken into account depend on the signal type.
The editor automatically prefills the properties depending on the signal type.
The table below lists the properties that are defined by conditions in the current version.

NOTE: See also <<Signal Aspect Resolution>>

[cols="2,2,2,5"]
|===
|Condition |Property Name in Editor |Related Objects |Description

|`TRAIN_NOT_PRESENT_ON_ITEMS`
|No Trains params
|Track Items
|List of items IDs on which there must not be a train for the aspect to show.
If there is a train on a single item of the list, the aspect does not show.

|`TRAIN_PRESENT_ON_ITEMS`
|Train Present Params
|Track Items
|List of items IDs on which there must be a train for the aspect to show.
If a train is missing on a single item of the list, the aspect does not show.

|`ROUTES_SET`
|Route set params
|Routes
|List of route IDs which can be activated for the aspect to show.
The aspect shows as soon as at least one of the specified route is active.

|===

==== Points Items

Points items are track switches.
They have three extremity: the common, normal and reverse ends as shown below.

image::pointsitem.png[align=center]

===== Definition Attributes

Common attributes `x` and `y` define the position of the center of points item.
Each extremity is at -5 or +5 along x and y axis.

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`xf`
|Common End
|Position of the common extremity along the x-axis.
Must be equal to -5, 0 or +5.

|`yf`
|Common End
a|Position of the common extremity along the y-axis.
Must be equal to -5, 0 or +5.

WARNING: y-axis increases from top to bottom.

|`xn`
|Normal End
|Position of the normal extremity along the x-axis.
Must be equal to -5, 0 or +5.

|`yn`
|Normal End
a|Position of the normal extremity along the y-axis.
Must be equal to -5, 0 or +5.

WARNING: y-axis increases from top to bottom.

|`xr`
|Reverse End
|Position of the reverse extremity along the x-axis.
Must be equal to -5, 0 or +5.

|`yr`
|Reverse End
a|Position of the reverse extremity along the y-axis.
Must be equal to -5, 0 or +5.

WARNING: y-axis increases from top to bottom.

|===

[NOTE]
====
In the editor, these attributes are defined by setting the cardinal point of the extremity such as:

- N => (0, -5)
- SW => (-5, +5)
====

===== Technical Attributes

[cols="2,8"]
|===
|Technical Name  |Description

|`reverseTiId`
|ID of the track item connected to this item at its "reverse" end.

This is computed automatically by the editor.

|`reverse`
|true if the points are set to the reverse end, and false if they are set to the normal end.

|===

==== Platform Items

Platform items are mostly decorative.
They can be linked to a place and a track code.

image::platformitem.png[align=center]

Common attributes `x` and `y` define the position of "Point 1".

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`xf`
|Point 2
|Position of Point 2 along the x-axis.

|`yf`
|Point 2
a|Position of Point 1 along the y-axis.

WARNING: y-axis increases from top to bottom.

|`placeCode`
|Place code
|Code of the place item this platform item belongs to.
The place being a station or a waypoint.

|`trackCode`
|Track code
|The code of this platform as known in the place defined by `placeCode`.
Typically a platform number.

|===

==== End Items

End items are technical items used to connect free extremities of the simulation.

image::enditem.png[align=center]

All extremities, including those after a buffer **MUST** be filled with an end item, so that all items are linked to other items.

==== Place Items

Places represent  stations or waypoints. They are represented by a text label on the scenery.

image::place.png[align=center]

The common attribute `name` is the name of the place as displayed.

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`placeCode`
|Place code
|Code that will be used to reference this place in other items.

|===

==== InvisibleLink Items

Invisible links work exactly the same way as line items, but are not represented at all on the scenery.

image::invisiblelink.png[align=center]

==== Text Items

Text items are purely decorative.
Use them to add labels which are not station or waypoint names, such as track or platform no.

image::text.png[align=center]


The caption is set through the `name` attribute.

=== Routes

A route is a locked path from one signal to another signal.
It will lock all the points in the correct position and open the entry signal.
The route is locked until either a train passes over, or the signaller cancels the route manually.

image::route.png[align=center]

A route can be set as "persistent".
In this case, it cannot be released by a train and must be cancelled manually.

==== Definition Attributes

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`id`
|Route no.
|Route ID used to reference this Route.
It is set automatically by the editor and cannot be changed.

|`beginSignal`
|Begin Signal
|ID of the entry signal item on the scenery.

|`endSignal`
|End Signal
|ID of the exit signal item on the scenery.

|`initialState`
|Initial state
|State of the route at the beginning of the simulation.
Takes a <<RouteStates,Route State>> Value

|===

====
[[RouteStates]]
**Route States Values**

[cols="1,2"]
|===
|Value| Description

|0
|Route is not set

|1
|Route is set, with automatic release when a train passes over

|2
|Route is set and persistent

|===
====

==== Technical Attributes

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`state`
|Current state
|Current state of the route.
Takes a <<RouteStates,Route State>> Value

|`directions`
|Points directions
|Map of the points directions along this route.
Each key is a points item ID and the value a <<PointsPositions,Points Position>> value such as `{"512":1,"521":1}`

If a points does not appear in the map, either its position is obvious (i.e. route goes from the normal or reverse end to the common end)
or it is assumed that it is in the "normal" position.
|===

====
[[PointsPositions]]
**Points Positions Values**

[cols="1,2"]
|===
|Value| Description

|0
|Normal position

|1
|Reversed position (i.e. diverging)

|2
|Unknown position, usually because the points are moving

(not implemented yet, reserved for future releases)

|3
|Points have a failure

(not implemented yet, reserved for future releases)

|===
====

=== Train Types

Train types are the different kinds of rolling stock available in the simulation.

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`id`
|Code
|Code used to reference this train type

|`description`
|Description
|Human readable description of this train type (e.g. "Class 313/2 EMU")

|`length`
|Length (m)
|Length in metres of this rolling stock

|`maxSpeed`
|Max speed (m/s)
|Maximum speed in metres per second

|`stdAccel`
|Std acceleration (m/s2)
|Standard acceleration in metres per square second.
A train will always speed up on a constant ramp (over time) defined by this value.

|`stdBraking`
|Std braking (m/s2)
|Standard braking in metres per square second.
A train will slow down on a constant ramp (over time) defined by this value when it can foresee a speed limit ahead with sufficient prior notice.

|`emergBraking`
|Emerg. braking (m/s2)
|Maximum braking capacity in metres per square second.
When a speed limit arises without sufficient prior notice, the train will brake as much as it can with a constant ramp (over time), not exceeding this value.

|`elements`
|Elements (codes list)
|List of other train type codes this rolling stock is composed of, such as `["C313-2", "C313-2"]`

This information will be used in future version for splitting/joining trains.
|===

=== Services

Services are train schedules.
A service is composed of several lines, defined by a place and a time.

==== Service Attributes

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`id`
|Code
|Code used to reference this service.
It the code that will be used as the train descriptor on the layout.

|`description`
|Description
|Free human readable description of the service.

|`plannedTrainType`
|Planned Train Type
|The train type code that is expected for this service.

|`postActions`
|Next service code / Auto reverse
|Actions to be performed automatically by a train when it terminates this service.
It must be a list of <<TrainActions,train actions>>.

e.g. `"postActions":[{"actionCode":"SET_SERVICE","actionParam":"WB02"},{"actionCode":"REVERSE","actionParam":""}]`

|`lines`
|
|Lines of this service. It is a list of <<Service Line Attributes, service lines>> as defined below.

|===

====
[[TrainActions]]
**Train Actions**

A train action is a map with two keys:

[cols="1,2"]
|===
|`actionCode`|The code of the action to perform (see below).
|`actionParam`|The parameters for the action (if applicable for the given action).
|===

Currently two actions are implemented

[cols="1,1,2"]
|===
|Action Code|Action Parameters|Description

|`SET_SERVICE`
|service code
|Assign the service with the given service code to this train.

In the editor, this action is set by filling in the "Next service code".

|`REVERSE`
|None
|Reverse the train direction.

In the editor, this action is set by the "Auto reverse" field.

|===

====

==== Service Line Attributes

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`placeCode`
|Place code
|Code of the place (station or waypoint)

|`scheduledArrivalTime`
|Arrival Time
|Time at which the train is expected to arrive at the place of this line.

Should be left empty (i.e. "00:00:00") when the train does not stop at this place.

|`scheduledDepartureTime`
|Departure Time
|Time at which the train is expected to depart (or pass) at the place of this line.

|`mustStop`
|Stop
|Set to `true` if the train must stop at this station.

|`trackCode`
|Track code
|Track or platform no. at which this train is expected to stop (or pass) at this place.

|===

=== Trains

Trains are the rolling stock instances that run in the Simulation.
Most of the time a service is assigned to a train.

==== Definition Attributes

[cols="2,3,8"]
|===
|Technical Name |Attribute Name in Editor |Description

|`id`
|id
a|Internal ID of the train, automatically assigned.

NOTE: This ID is an integer and can be different in the editor and in the simulation.

|`serviceCode`
|Service code
|ID of the service assigned to this train

|`trainTypeCode`
|Train type
|ID of the rolling stock type of this train

|`appearTime`
|Entry time
|Time at which this train appears on the layout

|`trainHead`
|Entry position
|Position of the train head. This is a <<Positions,position>> object.

|`initialSpeed`
|Entry speed
|Speed of this train when it appears on the scenery

|`initialDelay`
|Initial delay
|Delay from `appearTime` that this train will have when entering the area.
This field is either an integer (in seconds) or a <<DelayGenerators,delay generator>>.

Set this field to 0 tu user the `defaultDelayAtEntry` value from the <<Options,options>>

|===

====
[[Positions]]
**Positions**

A position object uniquely defines a position and a direction on the scenery.

[cols="1,3"]
|===
|Attribute Name |Description

|`trackItem`
|ID of the item this position is on.

|`previousTI`
|ID of one of the connected item defined as "Previous Item" to give the direction.

|`positionOnTI`
|Number of metres between this position and the extremity of `trackItem` that is connected to `previousTI`.

|===


On the image below, positions `P1` and `P2` are defined as follow:

`P1 = {"trackItem":"2","previousTI":"1","positionOnTI":73}`

`p2 = {"trackItem":"2","previousTI":"3","positionOnTI":98}`

.Positions
image::position.png[align=center]

====

==== Technical Attributes

[cols="2,8"]
|===
|Technical Name |Description

|`status`
|Current status of the train. See available <<TrainStatus,train status values>>.

|`speed`
|Current speed of the train in metres per second

|`nextPlaceIndex`
|Index of the next service line, i.e. the index to the next station or waypoint. Counted from 0.

|`stoppedTime`
|The number of seconds the train has stopped at the station.
If the train status is not "Stopped", this value has no meaning.

|===

====
[[TrainStatus]]
**Train Status Values**

[cols="1,1,3"]
|===
|Code |Status | Description

|0  |Inactive    |The train has not entered the area yet
|10 |Running     |The train is running with a non zero speed
|20 |Stopped     |The train is stopped at a station
|30 |Waiting     |The train is waiting at a red signal or other unscheduled stop
|40 |Out         |The train exited the area
|50 |EndOfService|The train has finished its service and has not been assigned a new one
|===
====

==== Standard Train Behaviour

Train behaviours are defined in compile-time plugins called train managers.
TS2 ships by default with a "Standard Manager" which makes the trains behave as described in this section.

The train driver will always try to reach the maximum possible speed limited by :

- The train type's maximum speed
- The speed limit of the line, both the current limit and reduced speed limits ahead
- The distance to the next station the train should stop
- The speed limit imposed by signals

For speed limits ahead (such as reduced line speed or next station or signal aspect),
 the maximum speed allowed is defined by a constant speed ramp (over time) of `stdBraking` (or `stdAccel`)
 in order to be at the target speed at the target point.

=== Signal Library

The Signal Library holds the information about each signal available in the simulation.
It is composed of a list of "Signal Aspects" and "Signal Types".

Signal Aspect::
A signal aspect is the colour of a signal lamp or combination of lamps on one signal.
The signal aspect provides an unambiguous message to the driver of a train.
In TS2, this message is a list of actions to perform.

Signal Type::
A signal type defines a kind of signal capable of displaying a set of aspects depending on conditions.

NOTE: The signal type usually differs between the simulation and reality, as a signal type in the simulation can be configured to simulate several real types.

==== Signal Aspects

===== General Attributes
[cols="2,8"]
|===
|Technical Name |Description

|`name`
a|Code of the signal aspect. This code must be unique and is used to reference this aspect in the simulation.

|`lineStyle`
a|Defines how the line along the signal must be displayed.
Possible values are:

[cols="1,1,3"]
,===
Code,Style,Description

`0`,`lineStyle`,Normal signal placed on the side of the line
`1`,`bufferStyle`,Buffer
,===

|`actions`
a|List of actions to be done by the train driver when seeing this signal. See <<SignalActions,signal actions>>

Examples
[cols="1,3"]
:===
`[[2, 0]]`: Prepare to stop before the next signal.
`[[1, 0, 60], [0, 8.33]]`: Stop before this signal, wait 60 seconds and proceed at 8.33 m/s (30 km/h).
:===
|===

====
[[SignalActions]]
**Signal Actions**

A signal action is a triplet with, in order:

- A <<Targets,target>>
- A speed limit (in m/s) to respect at target
- A delay in seconds before executing the next action (optional if there is no next action)


[[Targets]]
.Signal Action Targets
[cols="1,1,3"]
|===
|Code |Target |Description

|0 |ASAP |The target speed should be applied as soon as possible
|1 |BeforeThisSignal |The target speed should be applied before the train reaches this signal
|2 |BeforeNextSignal |The target speed should be applied before the train reaches the signal after this one.

|===
====

===== Display Attributes

Signal aspects in TS2 can show up to 6 lamps at the same time (numbered 0 to 5) that are arranged like this:

image::signalaspect.png[align=center]

Attributes in the table below that are lists, the items of which refer to each lamp based on its index (counted from 0).
Clients are expected to render signals as explained below.

[cols="2,8"]
|===
|Technical Name |Description

|`outerShapes`
|List of outer shapes.
Outer shapes should be drawn first.
Each item of the list must be <<ShapeCode,shape code>>.

|`outerColors`
|List of colors to fill the outer shapes.
Each item of the list must be a #RRGGBB color string.

|`shapes`
|List of shapes.
Shapes should be drawn in front of outerShapes without transparency.
Each item of the list must be <<ShapeCode,shape code>>.

|`shapesColors`
|List of colors to fill the shapes.
Each item of the list must be a #RRGGBB color string.

|`blink`
|List of boolean values.
If the value is true, the corresponding lamp should be displayed as flashing.

|===

====
[[ShapeCode]]
**Shape Codes**

[cols="1,1,3"]
|===
|Code |Shape |Image

|0  |`none`   |Nothing should be drawn at the position of the corresponding lamp.
|1  |`circle` a|image::circleShape.png[]
|2  |`square` a|image::squareShape.png[]
|10  |`quarterSW` a|image::quarterSWShape.png[]
|11  |`quarterNW` a|image::quarterNWShape.png[]
|12  |`quarterNE` a|image::quarterNEShape.png[]
|13  |`quarterSE` a|image::quarterSEShape.png[]
|20  |`barNS` a|image::barNSShape.png[]
|21  |`barEW` a|image::barEWShape.png[]
|22  |`barSWNE` a|image::barSWNEShape.png[]
|23  |`barNWSE` a|image::barNWSEShape.png[]
|31  |`poleNS` a|image::poleNSShape.png[]
|32  |`poleNSW` a|image::poleNSWShape.png[]
|33  |`poleSW` a|image::poleSWShape.png[]
|34  |`poleNE` a|image::poleNEShape.png[]
|35  |`poleNSE` a|image::poleNSEShape.png[]

|===

NOTE: Cardinal points in the Shape and images code should be understood **with the signal head up**
(i.e. N to the right of the screen, or to the left is signal is reversed).
====

.Signal aspects rendering examples
====
[cols="1,3"]
|===

a|image::signalAspectExample2.png[align=center]
a|
----
{
    "__type__": "SignalAspect",
    "actions": [[1, 0]],
    "blink": [false, false, false, false, false, false],
    "lineStyle": 0,
    "outerColors": ["#000000", "#000000", "#000000", "#000000", "#000000", "#000000"],
    "outerShapes": [0, 0, 0, 0, 0, 0],
    "shapes": [1, 0, 0, 0, 0, 0],
    "shapesColors": ["#00FF00", "#000000", "#000000", "#000000", "#000000", "#000000"]
}
----

a|image::signalAspectExample3.png[align=center]
a|
----
{
    "__type__": "SignalAspect",
    "actions": [[0, 999]],
    "blink": [false, false, false, false, false, false],
    "lineStyle": 0,
    "outerColors": ["#FFFFFF", "#000000", "#000000", "#000000", "#000000", "#000000"],
    "outerShapes": [2, 0, 0, 0, 0, 0],
    "shapes": [1, 0, 0, 0, 0, 0],
    "shapesColors": ["#FF0000", "#000000", "#000000", "#000000", "#000000", "#000000"]
}
----

a|image::signalAspectExample1.png[align=center]
a|
----
{
    "__type__": "SignalAspect",
    "actions": [[1, 0]],
    "blink": [false, false, false, false, false, false],
    "lineStyle": 0,
    "outerColors": ["#000000", "#000000", "#000000", "#FFFF00", "#000000", "#000000"],
    "outerShapes": [0, 0, 0, 1, 0, 0],
    "shapes": [1, 0, 32, 22, 12, 0],
    "shapesColors": ["#FF0000", "#000000", "#000000", "#FFFFFF", "#FF00FF", "#000000"]
}
----

|===
====

==== Signal Types


==== Signal Aspect Resolution

== Writing a simulation

== Websocket API

== Developing a Client
